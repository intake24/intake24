import{_ as a,c as t,o as s,ag as i}from"./chunks/framework.D22YC4c3.js";const u=JSON.parse('{"title":"Getting started","description":"","frontmatter":{},"headers":[],"relativePath":"developer/getting-started.md","filePath":"developer/getting-started.md"}'),o={name:"developer/getting-started.md"};function n(d,e,l,r,c,p){return s(),t("div",null,[...e[0]||(e[0]=[i(`<h1 id="getting-started" tabindex="-1">Getting started <a class="header-anchor" href="#getting-started" aria-label="Permalink to &quot;Getting started&quot;">​</a></h1><h2 id="dev-instance" tabindex="-1">Dev instance <a class="header-anchor" href="#dev-instance" aria-label="Permalink to &quot;Dev instance&quot;">​</a></h2><p>Steps to getting a local instance running</p><ul><li>Setup the database <ul><li>Method 1 (prefered): Execute Docker compose file <code>docker-compose.yml</code> to prepare PostgresQL and Redis instances, and map out port 5432 and 6379 respectively by default.</li><li>Method 2: Run Dev VM (download from S3 bucket - contact the Intake24 team), which maps out the database on 192.168.56.10:5432 (PostgreSQL). Start this VM.</li></ul></li><li>Obtain up-to-date database snapshots from the intake24 team and import them into a database by scripts or DB tools (e.g. DBeaver). Please check the guidance on <a href="https://dbeaver.com/docs/wiki/Backup-Restore/" target="_blank" rel="noreferrer">importing database snapshots with DBeaver</a>.</li><li>Local servers need to be run for <code>api</code>, <code>admin</code> and <code>survey</code> from each respective folder:</li><li>To start <code>api</code> / <code>admin</code> / <code>survey</code>: <code>pnpm dev</code> for live reloads</li></ul><h3 id="steps-to-run-locally" tabindex="-1">Steps to run locally <a class="header-anchor" href="#steps-to-run-locally" aria-label="Permalink to &quot;Steps to run locally&quot;">​</a></h3><h4 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h4><ul><li>Node.js v22.12.0 or newer</li><li>pnpm v9.x or newer</li><li>Docker v29 or newer (for running PostgreSQL 17 and Redis 8 instances)</li><li>4vGB+ free disk space (Or 50GB+ free disk space including downloading and extracting food images and database snapshots)</li></ul><h4 id="_1-git-clone-intake24-project" tabindex="-1">1. Git clone Intake24 project <a class="header-anchor" href="#_1-git-clone-intake24-project" aria-label="Permalink to &quot;1. Git clone Intake24 project&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/intake24/intake24.git</span></span></code></pre></div><h4 id="_2-install-node-packages-for-the-whole-projects" tabindex="-1">2. Install node packages for the whole projects <a class="header-anchor" href="#_2-install-node-packages-for-the-whole-projects" aria-label="Permalink to &quot;2. Install node packages for the whole projects&quot;">​</a></h4><p>On project root folder, run</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div><h4 id="_3-spin-up-redis-and-postgresql-instance-using-docker-compose" tabindex="-1">3. Spin up Redis and PostgreSQL instance using docker compose <a class="header-anchor" href="#_3-spin-up-redis-and-postgresql-instance-using-docker-compose" aria-label="Permalink to &quot;3. Spin up Redis and PostgreSQL instance using docker compose&quot;">​</a></h4><p>On project root folder, run</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre></div><h4 id="_4-initialise-the-cli-application" tabindex="-1">4. Initialise the CLI application <a class="header-anchor" href="#_4-initialise-the-cli-application" aria-label="Permalink to &quot;4. Initialise the CLI application&quot;">​</a></h4><p>On project root folder, run below command to build the CLI application under <code>apps/cli</code> folder using development configuration</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cli:dev</span></span></code></pre></div><p>This will create <code>.env</code> file under <code>apps/cli</code> folder, and complete the initial setup for the CLI application. You can quite the process after the command finishes.</p><h4 id="_5-use-cli-tools-to-create-env-files-for-intake24-api-intake24-frontend-spa-and-intake24-admin-tool-spa-applications-and-populate-system-database" tabindex="-1">5. Use CLI tools to create .env files for Intake24 API, Intake24 frontend (SPA), and Intake24 admin tool SPA applications, and populate system database <a class="header-anchor" href="#_5-use-cli-tools-to-create-env-files-for-intake24-api-intake24-frontend-spa-and-intake24-admin-tool-spa-applications-and-populate-system-database" aria-label="Permalink to &quot;5. Use CLI tools to create .env files for Intake24 API, Intake24 frontend (SPA), and Intake24 admin tool SPA applications, and populate system database&quot;">​</a></h4><p>on project root folder, run below command</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init:env</span></span></code></pre></div><p>This will create <code>.env</code> files under <code>apps/api</code>, <code>apps/admin</code> and <code>apps/survey</code> folders, and populate the system database with default data. You can also use <code>-f</code> flag to force overwrite existing <code>.env</code> files if any.</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init:db:system</span></span></code></pre></div><p>This will populate the system database with default data only. Follow the prompts to set up the admin user account.</p><p>If the database snapshot versions are older than the codebase, you may need to run database migration scripts to <code>foods</code> and <code>system</code> databases by running below command under project root folder:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:system:migrate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:foods:migrate</span></span></code></pre></div><p>For more information, please refer to <a href="./../overview/database#database-migrations">Database migrations</a>.</p><h4 id="_6-start-api-server" tabindex="-1">6. Start API server <a class="header-anchor" href="#_6-start-api-server" aria-label="Permalink to &quot;6. Start API server&quot;">​</a></h4><p>On <code>apps/api</code> folder, run</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span></code></pre></div><p>The API server should be running on <code>http://localhost:3100</code> by default.</p><h4 id="_7-start-intake24-admin-tool-application" tabindex="-1">7. Start Intake24 admin tool application <a class="header-anchor" href="#_7-start-intake24-admin-tool-application" aria-label="Permalink to &quot;7. Start Intake24 admin tool application&quot;">​</a></h4><p>On <code>apps/admin</code> folder, run</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span></code></pre></div><p>The Intake24 admin tool application should be running on <code>http://localhost:8100</code> by default, and you can log in using the admin account created during step 5.</p><h4 id="_8-start-intake24-frontend-survey-application" tabindex="-1">8. Start Intake24 frontend (survey) application <a class="header-anchor" href="#_8-start-intake24-frontend-survey-application" aria-label="Permalink to &quot;8. Start Intake24 frontend (survey) application&quot;">​</a></h4><p>On <code>apps/survey</code> folder, run</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span></code></pre></div><p>The Intake24 frontend (survey) application should be running on <code>http://localhost:8200</code> by default.</p><h4 id="_9-download-food-images-and-place-them-in-the-correct-folder" tabindex="-1">9. Download food images and place them in the correct folder <a class="header-anchor" href="#_9-download-food-images-and-place-them-in-the-correct-folder" aria-label="Permalink to &quot;9. Download food images and place them in the correct folder&quot;">​</a></h4><p>Food images are not included in the database snapshots. Run the following command to download and extract the images:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init:food-images</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://storage.googleapis.com/intake24/images/intake24-images-MRC-LIVE-19112025.zip</span></span></code></pre></div><p>If you have downloaded the image archive to local PC, you can extract to <code>apps/api/storage/public/images</code> directly.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Please note that currently the image arcihive is quite large (~18GB) and the download may take significant time and disk space.</p><p>And to save space, the CLI will remove the download zip file once it is decompressed to the <code>FS_IMAGES</code>.</p></div><p>For more information, please check <a href="./../cli/init-food-images">Download food images</a>.</p><h2 id="useful-tools" tabindex="-1">Useful tools <a class="header-anchor" href="#useful-tools" aria-label="Permalink to &quot;Useful tools&quot;">​</a></h2><ul><li>IDE for developing Node, Typescript, npm (Intake24 use <code>pnpm</code> as drop-in replacement of npm) and associated tooling (e.g. VS Code)</li><li>Docker, a clean and resource-efficient way to run PostgreSQL and Redis servers locally.</li><li>Virtual Box (v6.x minimum) for running database VM</li><li>Database browser (e.g. DBeaver) for exploring/manipulating PostgreSQL DB.</li><li>Redis</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Intake24 requires node.js version 16 or newer, please make sure to check your node.js version before continuing.</p></div><p>Clone the <a href="https://github.com/intake24/intake24" target="_blank" rel="noreferrer">Intake24 version 4 repository on GitHub</a>.</p><p>Follow the readme instructions in the root of the repository.</p><h2 id="databases" tabindex="-1">Databases <a class="header-anchor" href="#databases" aria-label="Permalink to &quot;Databases&quot;">​</a></h2><p>Please contact the intake24 team for the latest development virtual machine. <a href="https://docs.intake24.org/developer/vm" target="_blank" rel="noreferrer">Please also check the guidance on using the development virtual machine</a>. Alternatively, you can obtain database snapshots and import them to a PostgreSQL (version 17 or newer) instance using database browser (e.g. DBeaver).</p><p><a href="https://storage.googleapis.com/intake24/snapshots/foods_snapshot.pgcustom" target="_blank" rel="noreferrer">Foods database public download link</a><a href="https://storage.googleapis.com/intake24/snapshots/system_snapshot.sql" target="_blank" rel="noreferrer">System database public download link</a></p><p>Please check the guidance on <a href="https://dbeaver.com/docs/wiki/Backup-Restore/" target="_blank" rel="noreferrer">importing database snapshots with DBeaver</a>. While using the database snapshots, don&#39;t forget to set up your own Redis instance.</p><p>To install PostgresQL and Redis instanace using provided setup, go to <code>docker</code> folder to start containers in the background by:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The script also run DB script within <code>docker/init</code> folder, hence if you may need to grant execution right for the scripts inside this folder.</p></div><p>Please also check the <a href="/developer/docker">guideline</a> to configure or import database snapshot to PostgreSQL server created using docker.</p><h2 id="api-server" tabindex="-1">API server <a class="header-anchor" href="#api-server" aria-label="Permalink to &quot;API server&quot;">​</a></h2><p>Go to <code>api</code> and follow instructions in the readme file.</p><p>Copy the <code>.env-template</code> file to <code>.env</code> and change the following settings:</p><ul><li><code>JWT_ACCESS_SECRET</code> — set to any string (security doesn&#39;t matter for development purposes), e.g. <code>verybigsecret</code>,</li><li><code>JWT_REFRESH_SECRET</code> — same as above but use a different secret,</li><li><code>DB_CONNECTION_SSL</code> - set to <code>false</code> for if the instance is for development purpose</li><li><code>DB_SYSTEM_HOST</code> — set to <code>192.168.56.4</code> if using the development VM or alternatively point to your own database instance,</li><li><code>DB_SYSTEM_PORT</code>, <code>DB_SYSTEM_USERNAME</code>, <code>DB_SYSTEM_PASSWORD</code> — keep the default settings if using the VM or edit according to your own DB settings,</li><li><code>DB_FOODS_HOST</code> — set to <code>192.168.56.4</code> if using the development VM or alternatively point to your own database instance,</li><li><code>DB_FOODS_PORT</code>, <code>DB_FOODS_USERNAME</code>, <code>DB_FOODS_PASSWORD</code> — keep the default settings if using the VM or edit according to your own DB settings,</li><li><code>QUEUE_REDIS_HOST</code> — set to <code>192.168.56.4</code> if using the development VM or alternatively point to your own Redis instance.</li><li><code>APP_SECRET</code> - secret used to generate and verify admin logins. Please use a different secret.</li><li><code>DB_DEV_SYSTEM_URL</code> and <code>DB_DEV_FOODS_URL</code> - set the connection strings according to your VM <code>192.168.56.4</code>, or alternatively point to your own database instance. If you are using docker compose script provided, PostgresQL DB will be installed locally, using default port <code>5432</code>, user name <code>postgres</code> and password <code>postgres</code>. The connection string will become something like <code>postgres://postgres:postgres@localhost:5432/{intake24 DB name}</code></li><li><code>WEBPUSH_PUBLIC_KEY</code> and <code>WEBPUSH_PRIVATE_KEY</code> - check out <a href="./../config/api/services">API server configuration</a> to generate key pairs.</li></ul><p>Check that the settings are correct by starting the server with <code>pnpm dev</code>.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Add <code>DB_DEV_SYSTEM_DEBUG_QUERY_LIMIT=500</code> and <code>DB_DEV_FOODS_DEBUG_QUERY_LIMIT=500</code> to the API <code>.env</code> file to limit debug query char limit. It can prevent long queries from cluttering the console. The API server runs food indexing each time it starts so the console outputs can be quite a lot. The server does that for all locales in the food database, so for the DEV instance, you can also limit number of locales it runs against in <code>.env</code> by setting <code>APP_ENABLED_LOCALES = [&quot;UK_V2_2022&quot;]</code>.</p></div><h2 id="api-access" tabindex="-1">API access <a class="header-anchor" href="#api-access" aria-label="Permalink to &quot;API access&quot;">​</a></h2><p>If you had your account already created in the databse snapshot you are using, please add your email in DBeaver <code>users</code> tables, then go to <code>apps/cli</code>, and run <code>pnpm cli:dev hash-password yourNewPassword</code>.</p><p>Grab the hash and put it manually into the <code>password_hash</code> column of the <code>user_passwords</code> table for your user record (find you user_id in users). There will be a cli command available to create a whole new account without this manual hassle.</p>`,68)])])}const g=a(o,[["render",n]]);export{u as __pageData,g as default};
