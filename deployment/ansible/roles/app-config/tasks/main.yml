- name: '{{ app|upper }} | Include shared vars'
  include_vars: '../instances/{{ instance }}/shared/config.json'

- name: '{{ app|upper }} | Configuration update started | Instance: {{ instance }}'
  community.general.slack:
    channel: '{{ slack.channel }}'
    token: '{{ slack.token }}'
    msg: 'ðŸš€ Configuration update started | *Instance:* {{ instance }}'
  when:
    - slack.token is defined and slack.token | length > 0
    - slack.channel is defined and slack.channel | length > 0

- name: '{{ app|upper }} | Copy .env config file'
  become_user: '{{ env.user }}'
  copy:
    src: '{{ apps[app].env_file }}'
    dest: '{{ env.directory }}/{{ apps[app].path }}/.env'
    mode: '600'

- name: '{{ app|upper }} | Copy pm2 config file'
  become_user: '{{ env.user }}'
  copy:
    src: '{{ apps[app].pm2_file }}'
    dest: '{{ env.directory }}/{{ apps[app].path }}/ecosystem.config.cjs'
    mode: '644'
